<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Яндекс Карта v3</title>
    <script src="https://api-maps.yandex.ru/v3/?apikey=ef711d81-f625-4b3c-9d56-bfac2d9dd499&lang=ru_RU"></script>
    <style>
        html, body, #map { width: 100%; height: 100%; margin: 0; padding: 0; font-family: Arial, Helvetica, sans-serif; }
        .distance-label { position: absolute; top: 10px; left: 10px; background: white; padding: 10px; border-radius: 5px; box-shadow: 0 0 5px rgba(0,0,0,0.3); }
    </style>
    <script>
        async function initMap() {
            await ymaps3.ready;

            ymaps3.import.registerCdn('https://cdn.jsdelivr.net/npm/{package}', '@yandex/ymaps3-default-ui-theme@0.0');

            const { YMap, YMapDefaultSchemeLayer, YMapDefaultFeaturesLayer, YMapFeature } = ymaps3;
            const { YMapDefaultMarker } = await ymaps3.import('@yandex/ymaps3-default-ui-theme');

            const map = new YMap(document.getElementById('map'), {
                location: { center: [44.0, 55.0], zoom: 5 }
            });

            map.addChild(new YMapDefaultSchemeLayer());
            map.addChild(new YMapDefaultFeaturesLayer());

            const markers = [
                { coordinates: [32.045098, 54.782630], title: 'Смоленск', subtitle: '54.782630, 32.045098', color: 'red' },
                { coordinates: [55.958722, 54.735152], title: 'Уфа', subtitle: '54.735152, 55.958722', color: 'green' }
            ];

            // Добавляем метки на карту
            markers.forEach(markerData => {
                const marker = new YMapDefaultMarker({
                    coordinates: markerData.coordinates,
                    title: markerData.title,
                    subtitle: markerData.subtitle,
                    color: markerData.color,
                    size: 'normal'
                });
                map.addChild(marker);
            });

            // Координаты точек маршрута
            const routeCoordinates = [
                [32.045098, 54.782630], // Смоленск
                [40.9831, 55.7512], // Москва (примерная точка на жд линии)
                [55.958722, 54.735152] // Уфа
            ];

            // Добавляем линию маршрута
            const routeLine = new YMapFeature({
                geometry: { type: 'LineString', coordinates: routeCoordinates },
                style: { strokeWidth: 4, strokeColor: 'blue' }
            });
            map.addChild(routeLine);

            // Вычисляем расстояние между точками маршрута
            const distance = calculateDistance(routeCoordinates);
            document.getElementById('distance').innerText = `Расстояние по рельсам: ${distance.toFixed(2)} км`;
        }

        // Функция для вычисления расстояния (по ломаной маршрута)
        function calculateDistance(coords) {
            let totalDistance = 0;
            for (let i = 0; i < coords.length - 1; i++) {
                totalDistance += haversineDistance(coords[i], coords[i + 1]);
            }
            return totalDistance;
        }

        // Формула Хаверсина для вычисления расстояния между точками на сфере
        function haversineDistance(coord1, coord2) {
            const R = 6371; // Радиус Земли в км
            const [lon1, lat1] = coord1.map(deg => deg * Math.PI / 180);
            const [lon2, lat2] = coord2.map(deg => deg * Math.PI / 180);
            const dLat = lat2 - lat1;
            const dLon = lon2 - lon1;
            const a = Math.sin(dLat / 2) ** 2 + Math.cos(lat1) * Math.cos(lat2) * Math.sin(dLon / 2) ** 2;
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
        }
    </script>
</head>
<body onload="initMap()">
    <div id="map"></div>
    <div id="distance" class="distance-label">Расстояние по рельсам: ... км</div>
</body>
</html>
